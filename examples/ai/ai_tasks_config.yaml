# Example configuration for AI-powered automated tasks
# This demonstrates how to configure tasks that use AI capabilities

# Webhook configuration
webhooks:
  - name: "default"
    url: "https://open.feishu.cn/open-apis/bot/v2/hook/your-webhook-url"

# AI configuration with multiple provider support
ai:
  enabled: true

  # Primary model (OpenAI GPT-4)
  model: "openai:gpt-4o"
  api_key: ${OPENAI_API_KEY}

  # Fallback models for reliability
  fallback_models:
    - "anthropic:claude-3-5-sonnet-20241022"
    - "groq:llama-3.1-70b-versatile"

  # Provider-specific configuration
  provider_config:
    timeout: 60.0
    max_retries: 2
    # For Ollama (local models):
    # base_url: "http://localhost:11434/v1"

  # AI settings
  system_prompt: "You are a helpful AI assistant integrated with Feishu for automated tasks."
  temperature: 0.7
  max_tokens: 1000
  max_conversation_turns: 10
  conversation_timeout_minutes: 30

  # Features
  tools_enabled: true
  web_search_enabled: true
  web_search_max_results: 5
  structured_output_enabled: false
  output_validators_enabled: false

# Automated tasks with AI capabilities
tasks:
  # Task 1: Daily summary using AI
  - name: "daily_ai_summary"
    description: "Generate daily summary using AI"
    enabled: true

    schedule:
      mode: "cron"
      arguments:
        hour: 18
        minute: 0

    conditions: []

    actions:
      # AI generates the summary
      - type: "ai_query"
        ai_prompt: |
          Generate a brief daily summary for today.
          Include:
          1. Key accomplishments
          2. Pending items
          3. Tomorrow's priorities
          Keep it under 200 words and use bullet points.
        ai_user_id: "daily_summary_bot"
        ai_temperature: 0.7
        ai_save_response_as: "summary"

      # Send the summary
      - type: "send_message"
        message: |
          üìä Daily Summary

          ${summary}
        webhooks: ["default"]

    error_handling:
      retry_on_failure: true
      max_retries: 3
      on_failure_action: "log"

  # Task 2: Sentiment analysis with conditional actions
  - name: "sentiment_analysis_task"
    description: "Analyze feedback sentiment and take appropriate action"
    enabled: true

    schedule:
      mode: "interval"
      arguments:
        hours: 2

    conditions: []

    actions:
      # Fetch feedback (example - replace with actual data source)
      - type: "http_request"
        request:
          method: "GET"
          url: "https://api.example.com/feedback/latest"
          save_as: "feedback_data"

      # AI analyzes sentiment
      - type: "ai_query"
        ai_prompt: |
          Analyze the sentiment of this feedback and respond with only one word:
          POSITIVE, NEGATIVE, or NEUTRAL

          Feedback: ${feedback_text}
        ai_user_id: "sentiment_analyzer"
        ai_temperature: 0.3
        ai_save_response_as: "sentiment"

      # Process based on sentiment
      - type: "python_code"
        code: |
          sentiment = context.get('sentiment', '').strip().upper()

          if 'NEGATIVE' in sentiment:
              context['alert_level'] = 'üö® HIGH PRIORITY'
              context['action_needed'] = 'Immediate response required'
          elif 'POSITIVE' in sentiment:
              context['alert_level'] = '‚úÖ POSITIVE'
              context['action_needed'] = 'Share with team'
          else:
              context['alert_level'] = '‚ÑπÔ∏è NEUTRAL'
              context['action_needed'] = 'Monitor'

      # Send notification
      - type: "send_message"
        message: |
          ${alert_level} Feedback Alert

          Sentiment: ${sentiment}
          Action: ${action_needed}

          Feedback: ${feedback_text}
        webhooks: ["default"]

    error_handling:
      retry_on_failure: true
      max_retries: 2
      on_failure_action: "notify"
      notification_webhook: "default"

  # Task 3: AI content generation
  - name: "ai_content_generator"
    description: "Generate social media content using AI"
    enabled: true

    schedule:
      mode: "cron"
      arguments:
        hour: 9
        minute: 0
        day_of_week: "mon,wed,fri"

    conditions:
      - type: "day_of_week"
        days: ["Monday", "Wednesday", "Friday"]

    actions:
      # AI generates content
      - type: "ai_chat"
        ai_prompt: |
          Create an engaging social media post about ${topic}.

          Requirements:
          - Catchy headline
          - 2-3 key points
          - Call-to-action
          - Use relevant emojis
          - Keep under 280 characters
        ai_user_id: "content_creator"
        ai_temperature: 0.9
        ai_max_tokens: 300
        ai_save_response_as: "social_post"

      # Send for review
      - type: "send_message"
        message: |
          üì± Generated Social Media Post

          ${social_post}

          Topic: ${topic}
          #SocialMedia #AI #Content
        webhooks: ["default"]

    context:
      topic: "AI-powered automation"

    error_handling:
      retry_on_failure: true
      max_retries: 3
      on_failure_action: "log"

  # Task 4: Multi-step AI workflow
  - name: "ai_research_workflow"
    description: "Multi-step AI workflow: research, analyze, report"
    enabled: true

    schedule:
      mode: "interval"
      arguments:
        hours: 6

    conditions: []

    actions:
      # Step 1: Research
      - type: "ai_query"
        ai_prompt: |
          Research the latest trends in ${industry}.
          Provide 3 key insights with brief explanations.
        ai_user_id: "researcher"
        ai_save_response_as: "research"

      # Step 2: Analysis
      - type: "ai_query"
        ai_prompt: |
          Based on this research:
          ${research}

          Provide analysis of:
          1. Opportunities
          2. Challenges
          3. Recommendations
        ai_user_id: "analyst"
        ai_save_response_as: "analysis"

      # Step 3: Executive summary
      - type: "ai_query"
        ai_prompt: |
          Create an executive summary based on:

          Research: ${research}
          Analysis: ${analysis}

          Keep it concise and actionable (max 150 words).
        ai_user_id: "summarizer"
        ai_temperature: 0.5
        ai_save_response_as: "summary"

      # Step 4: Send report
      - type: "send_message"
        message: |
          üìä ${industry} Industry Report

          üîç Research Insights:
          ${research}

          üìà Analysis:
          ${analysis}

          üìã Executive Summary:
          ${summary}
        webhooks: ["default"]

    context:
      industry: "Artificial Intelligence"

    error_handling:
      retry_on_failure: true
      max_retries: 2
      on_failure_action: "log"

  # Task 5: AI-powered data processing
  - name: "ai_data_processor"
    description: "Process and categorize data using AI"
    enabled: true

    schedule:
      mode: "interval"
      arguments:
        minutes: 30

    conditions: []

    actions:
      # Fetch data to process
      - type: "http_request"
        request:
          method: "GET"
          url: "https://api.example.com/data/pending"
          save_as: "raw_data"

      # AI categorizes and processes
      - type: "ai_query"
        ai_prompt: |
          Categorize and summarize this data:
          ${raw_data}

          Provide:
          1. Category (Technical, Business, Support, Other)
          2. Priority (High, Medium, Low)
          3. Brief summary (1 sentence)

          Format as JSON.
        ai_user_id: "data_processor"
        ai_temperature: 0.3
        ai_structured_output: true
        ai_save_response_as: "processed_data"

      # Store results
      - type: "http_request"
        request:
          method: "POST"
          url: "https://api.example.com/data/processed"
          json_body:
            data: "${processed_data}"
            timestamp: "${timestamp}"

      # Notify completion
      - type: "send_message"
        message: |
          ‚úÖ Data Processing Complete

          Processed: ${processed_data}
        webhooks: ["default"]

    error_handling:
      retry_on_failure: true
      max_retries: 2
      on_failure_action: "notify"
      notification_webhook: "default"

# Event server configuration (for receiving Feishu events)
event_server:
  enabled: true
  auto_start: true
  host: "0.0.0.0"
  port: 8080
  path: "/webhook"
